---
toc: true
toc_label: "MySQL 主从复制"
toc_icon: "copy"
title: "MySQL 主从复制"
tags: mysql 主从 同步 复制
categories: "database"
classes: wide
excerpt: ""
header:
  overlay_image: /assets/images/header/mysql.jpg
  overlay_filter: rgba(0, 0, 0, 0.8)
---







## MySQL 主从复制简介

MySQL 的主从复制来源于其特有的词汇：复制，即 **Replication**。因此在 MySQL 的语境中，提到的复制主要是指这个复制，而不是通常意义的 copy。
{: .notice--success}

通过复制，可以让数据从一个 MySQL 数据库服务器被复制到另一个或多个 MySQL 数据库服务器中，前者称为 **主服务器**，即 Master，后者称为 **从服务器**，即 Slaves。这就是所谓的主从。

复制默认是 **单向**、 **异步** 进行的，因此，从服务器无需为了收到更新而一直保持连接。这就意味着更新是可以在远距离连接上进行的，甚至可以在临时的或间断性的连接上进行，如拨号连接。根据配置，可以复制全部数据库、部分数据库、或库中指定的表。





### 复制的优点

MySQL 内置的复制功能，配合使用这种可扩展的架构，是建设大型、高性能应用的基础。这种主从复制不仅仅有利于高性能的应用程序，它还是许多策略的基石，包括：高可用、可扩展性、灾难恢复、备份、数据分析、数据仓库等任务。

* 可扩展解决方案：把负载分摊到多个从服务器上，从而提升性能。在该环境下，所有的 **写** 和 **更新** 操作必须发生于 **主** 服务器上，即主服务器专用于更新。而 **读** 操作，可以发生在一个或多个 **从** 服务器上。这种模式一方面会提升写的性能，另一方面，不断增长的从服务器还会大大提升读的速度。

* 数据安全：因为数据被复制到从服务器，而且从服务器可以暂停复制的进程，因此，可以做到在从服务器上运行 **备份** 服务，同时还不会破坏对应的主服务器上的数据。

* 数据分析：可以在主服务器上创建实时数据，而对信息的分析可以发生在从服务器，不会影响主服务器的性能。

* 远距离数据分布：如果由于工作需要，公司在远方的分部门需要主数据的一个副本，可以利用复制在本地创建一个副本，而无需与主服务器保持持续的连接。







### 复制的分类

在两个服务器之间配置复制有很多种办法，但最好的办法取决于使用的数据以及引擎的类别。

MySQL 复制的格式有两个核心的类别：

* 基于 **语句** 的复制：SBR，Statement Based Replication。也称逻辑复制，它会复制全部 SQL 语句。
* 基于 **行** 的复制：RBR，Row Based Replication。只复制发生修改的行。


#### 传统的 基于日志的复制

早期的复制是基于主服务器的二进制日志，其中保存了主服务器对数据库所做的修改，从服务器读取这些日志，据此来在自己本地进行同样的操作，实现更新。

主服务器将更新写入 **二进制日志文件**，并维护文件的一个索引，以跟踪日志循环。当从服务器连接主服务器时，它会把自己在日志中读取的最后一次成功更新的位置告知主服务器。从服务器接收该位置之后发生的任何更新，然后封锁，等待主服务器通知新的更新。

#### 较新的 基于 GITD 的复制

在 MySQL 5.6.5 开始及之后的版本中，支持事务复制，是基于全局事务标识符，即 **GITD**，Global Transaction IDentifier。使用这类的复制时，无需直接处理日志文件或其偏移量，极大简化了许多日常的复制任务。因为使用 GTID 进行复制是完全事务性的，只要在主服务器上提交的所有事务都已应用于从服务器，则可以保证主从的一致性。
