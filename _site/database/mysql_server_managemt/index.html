<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.9.1 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="zh" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>MySQL 服务端的管理 - LINOTES</title>
<meta name="description" content="用简洁清晰的语言讨论技术">



<meta property="og:type" content="article">
<meta property="og:locale" content="zh_CN">
<meta property="og:site_name" content="LINOTES">
<meta property="og:title" content="MySQL 服务端的管理">
<meta property="og:url" content="http://localhost:4000/database/mysql_server_managemt/">


  <meta property="og:description" content="用简洁清晰的语言讨论技术">



  <meta property="og:image" content="http://localhost:4000/assets/images/header/mysql.jpg">



  <meta name="twitter:site" content="@liloli">
  <meta name="twitter:title" content="MySQL 服务端的管理">
  <meta name="twitter:description" content="用简洁清晰的语言讨论技术">
  <meta name="twitter:url" content="http://localhost:4000/database/mysql_server_managemt/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://localhost:4000/assets/images/header/mysql.jpg">
  

  



  <meta property="article:published_time" content="2016-03-01T00:00:00+08:00">





  

  


<link rel="canonical" href="http://localhost:4000/database/mysql_server_managemt/">







  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Hawk Zhang",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="LINOTES Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- <link rel="stylesheet" href="/assets/css/vim.css"> -->



  









<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="http://localhost:4000/">LINOTES</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/app/rsync/" >Rsync 的用法</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/server/vsftpd/" >Vsftpd 的用法</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/kernel/filedescriptor/" >文件描述符简介</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/tools/tools.datastream/" >数据流处理</a>
            </li>
          
        </ul>
        
        <button class="search__toggle" type="button">
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">切换菜单</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <div class="initial-content">
      
  











<div class="page__hero--overlay"
  style=" background-image: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)), url('http://localhost:4000/assets/images/header/mysql.jpg');"
>
  
    <div class="wrapper">
      <h1 class="page__title" itemprop="headline">
        
          MySQL 服务端的管理

        
      </h1>
      
        <p class="page__lead">
</p>
      
      
      
    </div>
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="http://localhost:4000/assets/images/bio-photo.jpg" alt="Hawk Zhang" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Hawk Zhang</h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">关注</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">北京</span>
        </li>
      

      

      
        <li>
          <a href="mailto:liloli@gmail.com">
            <meta itemprop="email" content="liloli@gmail.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> 电子邮箱
          </a>
        </li>
      

      

      
        <li>
          <a href="https://twitter.com/liloli" itemprop="sameAs">
            <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/hawkzhang" itemprop="sameAs">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/liloli" itemprop="sameAs">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
    
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">切换菜单</label>
  <ul class="nav__items">
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="MySQL 服务端的管理">
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="March 01, 2016">
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-copy"></i> MySQL 服务端的管理</h4></header>
              <ul class="toc__menu">
  <li><a href="#mysql-server">MySQL Server</a>
    <ul>
      <li><a href="#服务端的配置">服务端的配置</a></li>
      <li><a href="#服务端选项">服务端选项</a></li>
      <li><a href="#系统变量">系统变量</a></li>
      <li><a href="#状态变量">状态变量</a></li>
      <li><a href="#服务端的-sql-模式">服务端的 SQL 模式</a></li>
    </ul>
  </li>
  <li><a href="#mysql-数据目录">MySQL 数据目录</a></li>
  <li><a href="#mysql-系统数据库">mysql 系统数据库</a>
    <ul>
      <li><a href="#数据词典表">数据词典表</a></li>
      <li><a href="#授权系统表">授权系统表</a></li>
      <li><a href="#对象信息系统表">对象信息系统表</a></li>
      <li><a href="#日志系统表">日志系统表</a></li>
      <li><a href="#帮助系统表">帮助系统表</a></li>
      <li><a href="#时区系统表">时区系统表</a></li>
      <li><a href="#复制系统表">复制系统表</a></li>
      <li><a href="#优化器系统表">优化器系统表</a></li>
      <li><a href="#其它系统表">其它系统表</a></li>
    </ul>
  </li>
  <li><a href="#mysql-server-日志">MySQL Server 日志</a>
    <ul>
      <li><a href="#自定义查询日志的保存位置">自定义查询日志的保存位置</a></li>
      <li><a href="#错误日志">错误日志</a></li>
    </ul>
  </li>
  <li><a href="#mysql-server-组件">MySQL Server 组件</a></li>
  <li><a href="#一台主机运行多个-mysql-实例">一台主机运行多个 MySQL 实例</a></li>
</ul>
            </nav>
          </aside>
        
        <h2 id="mysql-server">MySQL Server</h2>

<p>本节内容主要引自 <a href="https://dev.mysql.com/doc/refman/8.0/en/"> MySQL 8.0 Reference Manual </a></p>

<p>MySQL 服务端</p>

<h3 id="服务端的配置">服务端的配置</h3>

<p>MySQL 的服务端程序为 mysqld，它包含许多命令 <strong>选项</strong> 及系统 <strong>变量</strong>，这些都可以在启动服务端时进行设置。</p>

<h4 id="查看所有选项和系统变量">查看所有选项和系统变量</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mysqld <span class="nt">--verbose</span> <span class="nt">--help</span>
</code></pre></div></div>

<p>该命令会列出所有的选项和可配置的系统变量。</p>

<h4 id="查看服务端运行中会使用的系统变量">查看服务端运行中会使用的系统变量</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SHOW</span> <span class="n">VARIABLES</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="查看服务端运行中的状态信息">查看服务端运行中的状态信息</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SHOW</span> <span class="n">STATUS</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="在-shell-中查看系统变量和状态信息">在 shell 中查看系统变量和状态信息</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mysqladmin <span class="nt">-u</span> root <span class="nt">-p</span> variables
<span class="nv">$ </span>mysqladmin <span class="nt">-u</span> root <span class="nt">-p</span> extended-status
</code></pre></div></div>

<h3 id="服务端选项">服务端选项</h3>

<p>启动 mysqld 服务时，可以通过 <strong>命令行、配置文件、变量</strong> 这三种方法来 <strong>定义</strong> 其运行的各种 <strong>选项</strong>。</p>

<p>在多数情况下，我们希望服务端每次都用同样的选项来工作，因此修改配置文件更满足这个要求。</p>

<p>mysqld 会从 <code class="highlighter-rouge">/var/lib/mysql/auto.cnf</code> 配置文件中读取 <code class="highlighter-rouge">[mysqld]</code> 和 <code class="highlighter-rouge">[server]</code> 区段的设置。</p>

<p>服务端选项、系统变量、状态变量加在一起的数量很庞大，<a href="https://dev.mysql.com/doc/refman/8.0/en/server-option-variable-reference.html">这里</a>有一个详细的列表可供查询。</p>

<p>有些选项用来控制缓冲区的大小。对于一个给定的缓冲区，服务端有时会需要分配内部数据结构，这些结构通常是从总内存中拿出来，分配到缓冲区的，其需要的存储空间大小依平台而有所不同。因此，如果通过选项指定了缓冲区的大小，最后得到的可用空间可能会有所差异。</p>

<p>有些选项的值是文件名。除非特别指定，如果是相对路径的话，默认的文件路径是数据目录。要想显式指定路径，应使用绝对路径。假设数据目录是 <code class="highlighter-rouge">/var/mysql/data</code>，如果某个选项指定了一个相对路径的文件名，则会被认为是在 <code class="highlighter-rouge">/var/mysql/data</code> 目录中。</p>

<p>用户给变量赋值后，MySQL 会在一定范围内自动纠错，将其调整到可用范围内最接近的值。</p>

<p>服务端运行时，可以用 <code class="highlighter-rouge">SET</code> 命令设置某些系统变量，如果希望提前对这些变量的最大值加以限制，可以在启动服务时以 <code class="highlighter-rouge">mysqld --maximum-var_name=value</code> 的形式指定。</p>

<h3 id="系统变量">系统变量</h3>

<p>MySQL 服务端维护了许多系统变量，它们体现了服务的具体配置。</p>

<p>每个系统变量都有一个默认值。这些变量可以在命令行指定，也可以在配置文件中指定。</p>

<p>它们中的大多数都可以在运行时用 <code class="highlighter-rouge">SET</code> 语句来动态修改，这样就可以无需停止或重启服务就可修改服务的运行。</p>

<p>可以在表达式中使用系统变量。</p>

<p>在运行时，要想设置系统变量的全局值通常需要 <code class="highlighter-rouge">SYSTEM_VARIABLES_ADMIN</code> 和 <code class="highlighter-rouge">SUPER</code> 的权限。</p>

<p><a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variable-reference.html">这里</a>有详细的服务端系统变量统计表。</p>

<h4 id="查看系统变量及当前的值">查看系统变量及当前的值</h4>

<p>要想查看服务端基于其编译默认的所有系统变量：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mysqld <span class="nt">--verbose</span> <span class="nt">--help</span>
</code></pre></div></div>

<p>要想从所有系统变量中把在配置文件中出现的排除掉：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mysqld <span class="nt">--no-defaults</span> <span class="nt">--verbose</span> <span class="nt">--help</span>
</code></pre></div></div>

<p>查看当前运行中的服务正在使用的变量及值：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SHOW</span> <span class="n">VARIABLES</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="系统变量的作用域">系统变量的作用域</h4>

<p>系统变量有两个作用域：<strong>全局</strong> 和 <strong>会话</strong>。</p>

<p>全局变量作用于运行的整个过程，会话变量作用于单个客户端的连接。</p>

<p>某个系统变量可能同时有一个全局的值，和一个会话的值。</p>

<ul>
  <li>服务启动时，会把每个全局变量初始化为其默认值。</li>
  <li>服务端为每个连接来的客户端维护一组会话变量，这些变量是在连接时初始化的，大多使用的是其全局变量当前的值。</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysqld <span class="nt">--innodb_log_file_size</span><span class="o">=</span>16M <span class="nt">--max_allowed_packet</span><span class="o">=</span>1G
</code></pre></div></div>

<p>相应地，如果要修改配置文件：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>mysqld]
<span class="nv">innodb_log_file_size</span><span class="o">=</span>16M
<span class="nv">max_allowed_packet</span><span class="o">=</span>1G
</code></pre></div></div>

<h4 id="修改变量">修改变量</h4>

<p>许多系统变量是动态的，可以在运行时使用 <code class="highlighter-rouge">SET</code> 语句修改。使用 <code class="highlighter-rouge">SET</code> 修改的配置在重启服务之后仍然有效。因为它不仅修改了运行时变量的值，还会把变量的新值写入配置文件 <code class="highlighter-rouge">/var/lib/mysql/auto.cnf</code> 中。</p>

<p class="notice--info"><code class="highlighter-rouge">/var/lib/mysql/auto.cnf</code> 配置文件完全由服务端自行管理，不要手动修改。</p>

<h5 id="赋值的单位">赋值的单位</h5>

<p>在 <strong>命令行</strong> 中启动服务时为变量赋值，后缀可以用 <code class="highlighter-rouge">K</code>、<code class="highlighter-rouge">M</code>、<code class="highlighter-rouge">G</code>，大小写均可，来表示 1024、1024<sup>2</sup>、1024<sup>3</sup> 等等。</p>

<p>在 <strong>运行时</strong> 为变量赋值时，不支持这些容量单位。</p>

<h5 id="用表达式赋值">用表达式赋值</h5>

<p>在 <strong>运行时</strong> 为变量赋值时，支持用表达式来赋值，如：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">max_allowed_packet</span><span class="o">=</span><span class="mi">16</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">;</span>
</code></pre></div></div>

<p>而在启动服务时则不支持用表达式赋值。</p>

<h5 id="设置全局变量">设置全局变量</h5>

<p>使用 <code class="highlighter-rouge">GLOBAL</code> 或 <code class="highlighter-rouge">@@global.</code>：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">max_connections</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">set</span> <span class="o">@@</span><span class="k">global</span><span class="p">.</span><span class="n">max_connections</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
</code></pre></div></div>

<p>使用 <code class="highlighter-rouge">PERSIST</code> 或 <code class="highlighter-rouge">@@persist.</code>：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SET</span> <span class="n">PERSIST</span> <span class="n">max_connections</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">SET</span> <span class="o">@@</span><span class="n">persist</span><span class="p">.</span><span class="n">max_connections</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
</code></pre></div></div>

<p>使用 <code class="highlighter-rouge">PERSIST_ONLY</code> 或 <code class="highlighter-rouge">@@persist_only</code></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SET</span> <span class="n">PERSIST_ONLY</span> <span class="n">back_log</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">SET</span> <span class="o">@@</span><span class="n">persist_only</span><span class="p">.</span><span class="n">back_log</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
</code></pre></div></div>

<p class="notice"><code class="highlighter-rouge">PERSIST_ONLY</code> 特殊的一点：它只会把赋值更新到配置文件，而不会修改运行时中的全局系统变量，因此更适合配置只读的系统变量，这些变量只能在启动服务的时候设置。</p>

<h5 id="设置会话变量">设置会话变量</h5>

<p>要想标记一个变量为会话变量，在变量名前面可以加上 <code class="highlighter-rouge">SESSION</code> 或 <code class="highlighter-rouge">@@session.</code> 关键字，或使用 <code class="highlighter-rouge">@@</code> 修饰符。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SET</span> <span class="k">SESSION</span> <span class="n">sql_mode</span> <span class="o">=</span> <span class="s1">'TRADITIONAL'</span><span class="p">;</span>
<span class="k">SET</span> <span class="o">@@</span><span class="k">session</span><span class="p">.</span><span class="n">sql_mode</span> <span class="o">=</span> <span class="s1">'TRADITIONAL'</span><span class="p">;</span>
<span class="k">SET</span> <span class="o">@@</span><span class="n">sql_mode</span> <span class="o">=</span> <span class="s1">'TRADITIONAL'</span><span class="p">;</span>
</code></pre></div></div>

<p>客户端只可以修改自己会话的变量。</p>

<p>如果变量只用于会话，则不会持续有效，因此没必要出现在配置文件中。</p>

<p><code class="highlighter-rouge">LOCAL</code> 和 <code class="highlighter-rouge">@@local</code> 与 <code class="highlighter-rouge">SESSION</code> 和 <code class="highlighter-rouge">@@session.</code> 是等效的。</p>

<p>使用 <code class="highlighter-rouge">SET</code> 命令时，如果没有使用修饰符，则默认为修改会话变量。</p>

<p>如果用设置会话变量的关键字来设置全局变量，或者反之，均会报错。</p>

<h5 id="同时为多个变量赋值">同时为多个变量赋值</h5>

<p>一条 <code class="highlighter-rouge">SET</code> 语句中可以为多个变量赋值，用逗号分隔：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SET</span> <span class="o">@</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="k">SESSION</span> <span class="n">sql_mode</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">sort_buffer_size</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span> <span class="k">SESSION</span> <span class="n">sort_buffer_size</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>
<span class="k">SET</span> <span class="o">@@</span><span class="k">global</span><span class="p">.</span><span class="n">sort_buffer_size</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span> <span class="o">@@</span><span class="k">local</span><span class="p">.</span><span class="n">sort_buffer_size</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>
<span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">max_connections</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">sort_buffer_size</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>
</code></pre></div></div>

<p>同时为多个变量赋值时，如果这些变量同属于全局变量或会话变量，关键字只需要使用一次即可，放在第一个变量前面，如上面最后一条语句。</p>

<p>如果 <code class="highlighter-rouge">SET</code> 语句中，某个变量的赋值失败，则整条语句都失败，哪个变量都不会改变，配置文件也不会被更新。</p>

<p>如果修改了会话变量，变量值在 <strong>会话期间</strong> 一直生效，直到会话结束。</p>

<p>如果修改了全局变量，变量值 <strong>始终</strong> 有效，并会用于 <strong>新产生的会话</strong>，直到服务退出。全局变量的修改对于访问该变量的 <strong>所有客户端都可见</strong>。</p>

<h4 id="变量的引用">变量的引用</h4>

<p>要想在表达式中引用系统变量，可以使用 <code class="highlighter-rouge">@@</code> 修饰符，除了 <code class="highlighter-rouge">@@persist.</code>，它不允许用于表达式。</p>

<p>如，在 <code class="highlighter-rouge">SELECT</code> 语句中获取变量的值：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">@@</span><span class="k">global</span><span class="p">.</span><span class="n">sql_mode</span><span class="p">,</span> <span class="o">@@</span><span class="k">session</span><span class="p">.</span><span class="n">sql_mode</span><span class="p">,</span> <span class="o">@@</span><span class="n">sql_mode</span><span class="p">;</span>
</code></pre></div></div>

<p>对于用 <code class="highlighter-rouge">@@var_name</code> 格式引用的变量名来说，MySQL 会返回其会话值，如果不存在，则返回全局值。而对于变量名中有句点的则不适用，如 <code class="highlighter-rouge">@@global.</code> 或 <code class="highlighter-rouge">@@session.</code> 格式的变量名。</p>

<h4 id="查询变量">查询变量</h4>

<h5 id="查看所有变量">查看所有变量</h5>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SHOW</span> <span class="n">VARIABLES</span><span class="p">;</span>
</code></pre></div></div>

<h5 id="用变量名检索">用变量名检索</h5>

<p>用 <code class="highlighter-rouge">LIKE</code> 子句来 <strong>匹配</strong> 特定的变量：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SHOW</span> <span class="n">VARIABLES</span> <span class="k">LIKE</span> <span class="s1">'max_join_size'</span><span class="p">;</span>
<span class="k">SHOW</span> <span class="k">SESSION</span> <span class="n">VARIABLES</span> <span class="k">LIKE</span> <span class="s1">'max_join_size'</span><span class="p">;</span>
</code></pre></div></div>

<h5 id="用模板检索">用模板检索</h5>

<p>在 <code class="highlighter-rouge">LIKE</code> 子句中使用通配符 <code class="highlighter-rouge">%</code> 或 <code class="highlighter-rouge">_</code> 来匹配变量：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SHOW</span> <span class="n">VARIABLES</span> <span class="k">LIKE</span> <span class="s1">'%size%'</span><span class="p">;</span>
<span class="k">SHOW</span> <span class="k">GLOBAL</span> <span class="n">VARIABLES</span> <span class="k">LIKE</span> <span class="s1">'%size%'</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="结构化的系统变量">结构化的系统变量</h4>

<p>结构化的变量与常规变量在两方面不同：</p>

<ul>
  <li><strong>变量值</strong> 是结构化的，由 <strong>多个组件</strong> 构成，每个组件用来描述不同的 <strong>服务参数</strong></li>
  <li>每一类结构化变量可以有 <strong>多个实例</strong>，每个实例的名字不同，代表着服务所维护的 <strong>不同的资源</strong></li>
</ul>

<h5 id="结构化系统变量的命名">结构化系统变量的命名</h5>

<p>MySQL 支持的这种结构化变量类型，其命名是这样的：</p>

<p><code class="highlighter-rouge">实例名.组件名</code></p>

<p>要想引用某个结构化变量实例中的某个组件，就使用上面这种复合的变量名。以 Key Cache 变量为例：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hot_cache.key_buffer_size
hot_cache.key_cache_block_size
cold_cache.key_cache_block_size
</code></pre></div></div>

<p>对于每个结构化系统变量来说，总是有个用 <code class="highlighter-rouge">default</code> 命名的 <strong>预定义的实例</strong>。如果在引用某个结构化变量时，没有指定实例名称，则会认为使用的是 <code class="highlighter-rouge">default</code> 实例。因此，<code class="highlighter-rouge">default.key_buffer_size</code> 与 <code class="highlighter-rouge">key_buffer_size</code> 指的是同一个系统变量。</p>

<p>结构化变量的实例和组件遵循以下命名规则：</p>

<ul>
  <li>对于一个特定的结构化变量的类型，每个实例的名称在 <strong>该类型</strong> 的变量中必须是 <strong>唯一</strong> 的。不同类型的变量可以使用相同的实例名。</li>
  <li>对于每个结构化变量类型来说，组件名称必须是唯一的。</li>
  <li>如果结构化变量名在未引用时是非法的，引用时需要用反引号。如 <code class="highlighter-rouge">hot-cahce</code> 是非法的，而 <code class="highlighter-rouge">`hot-chache`</code> 就是合法的。</li>
  <li>禁止用 <code class="highlighter-rouge">global</code>、<code class="highlighter-rouge">session</code>、<code class="highlighter-rouge">local</code> 做为实例的名称，以免与对应的非结构化系统变量冲突。</li>
</ul>

<h5 id="结构化变量的使用场景">结构化变量的使用场景</h5>

<p>只要能用普通变量的地方，就能用结构化的变量组件。如，用命令行选项为结构化变量赋值：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mysqld <span class="nt">--hot_cache</span>.key_buffer_size<span class="o">=</span>64K
</code></pre></div></div>

<p>在配置文件中也可以使用：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>mysqld]
hot_cache.key_buffer_size<span class="o">=</span>64K
</code></pre></div></div>

<h5 id="赋值及检索">赋值及检索</h5>

<p>要想为结构化变量赋值，以下两种格式都可以：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">hot_cache</span><span class="p">.</span><span class="n">key_buffer_size</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">;</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SET</span> <span class="o">@@</span><span class="k">global</span><span class="p">.</span><span class="n">hot_cache</span><span class="p">.</span><span class="n">key_buffer_size</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">;</span>
</code></pre></div></div>

<p>返回变量的值：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">@@</span><span class="k">global</span><span class="p">.</span><span class="n">hot_cache</span><span class="p">.</span><span class="n">key_buffer_size</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="状态变量">状态变量</h3>

<p>服务端的状态变量用于保存服务动作的信息。</p>

<p><a href="https://dev.mysql.com/doc/refman/8.0/en/server-status-variable-reference.html">这里</a>是详细的服务端状态变量统计表。</p>

<p>查看所有状态变量及当前的值：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SHOW</span> <span class="n">GOLBAL</span> <span class="n">STATUS</span><span class="p">;</span>
</code></pre></div></div>

<p>许多状态变量可以用 <code class="highlighter-rouge">FLUSH STATUS</code> 来重置为 0。</p>

<h3 id="服务端的-sql-模式">服务端的 SQL 模式</h3>

<p>MySQL 服务端能够以不同的 SQL 模式运转，并且能够为不同的客户端应用不同的模式，取决于 <code class="highlighter-rouge">sql_mode</code> 这个系统变量。DBA 可以设置全局的 SQL 模式，以匹配网站服务运营的需求，每个程序都可以根据自己的需求来设置其会话的 SQL 模式。</p>

<p>不同的模式会影响对 SQL 语法的支持，以及对数据有效性的检查。这一点使得在不同的环境中使用 MySQL 变的更加容易，同样地，也更容易与其它数据库服务一同使用。</p>

<h4 id="设置-sql-模式">设置 SQL 模式</h4>

<p>MySQL 8.0 的默认 SQL 模式包括：<code class="highlighter-rouge">ONLY_FULL_GROUP_BY</code>、<code class="highlighter-rouge">STRICT_TRANS_TABLES</code>、<code class="highlighter-rouge">NO_ZERO_IN_DATE</code>、<code class="highlighter-rouge">NO_ZERO_DATE</code>、<code class="highlighter-rouge">ERROR_FOR_DIVISION_BY_ZERO</code>、<code class="highlighter-rouge">NO_ENGINE_SUBSTITUTION</code>。</p>

<p>若要在服务启动时设置 SQL 模式，可用 <code class="highlighter-rouge">--sql-mode="modes"</code> 选项，或在配置文件中使用 <code class="highlighter-rouge">sql-mode="modes"</code>。其中的 <code class="highlighter-rouge">modes</code> 可以是不同模式的列表，用逗号分隔。若要显式清除 SQL 模式，可在命令行用 <code class="highlighter-rouge">--sql-mode=""</code> 或在配置文件中用 <code class="highlighter-rouge">sql-mode=""</code>。</p>

<p>要在运行时更改 SQL 模式，可用 <code class="highlighter-rouge">SET</code> 语句来设置全局或会话变量 <code class="highlighter-rouge">sql_mode</code>：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">sql_mode</span> <span class="o">=</span> <span class="s1">'modes'</span><span class="p">;</span>
<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">sql_mode</span> <span class="o">=</span> <span class="s1">'modes'</span><span class="p">;</span>
</code></pre></div></div>

<p>查询当前模式：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">@@</span><span class="k">GLOBAL</span><span class="p">.</span><span class="n">sql_mode</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="o">@@</span><span class="k">SESSION</span><span class="p">.</span><span class="n">sql_mode</span><span class="p">;</span>
</code></pre></div></div>

<p class="notice--warning"><strong>SQL 模式与用户定义的分区</strong> ： 分了区的表被创建并插入数据以后，如果要修改服务端 SQL 模式，表的行为会发生很大变化，有可能会引起数据的丢失和损坏。因此，强烈建议用户在对表进行分区之后，永远不要修改 SQL 模式。<br /><br />在复制分了区的表时，从表和主表必须使用相同的 SQL 模式。</p>

<h2 id="mysql-数据目录">MySQL 数据目录</h2>

<p>MySQL 服务端管理的信息保存在一个目录中，该目录称为数据目录。CentOS 7 中，该数据目录为 <code class="highlighter-rouge">/var/lib/mysql</code>。</p>

<p>数据目录中常见的项目主要有：</p>

<ul>
  <li>数据目录的 <strong>子目录</strong>。每个子目录都是一个数据库目录，对应一个服务端管理的数据库。
    <ul>
      <li><code class="highlighter-rouge">mysql</code> 子目录中的是 mysql 的系统数据库，其中包含 MySQL 服务端运行所需的信息。</li>
      <li><code class="highlighter-rouge">performance_schema</code> 子目录中的数据库，用于审查服务端在运行时其内部的执行情况。</li>
      <li><code class="highlighter-rouge">sys</code> 子目录中的数据库，会提供一组对象，来帮助解释 performance_schema 中的信息。</li>
      <li>其他子目录为用户或应用程序建立的数据库。</li>
    </ul>
  </li>
  <li>服务端保存的日志文件</li>
  <li><code class="highlighter-rouge">InnoDB</code> 表空间及日志文件</li>
  <li>默认的，或自动生成的 SSL 及 RSA 证书及密钥文件。</li>
  <li>服务端进程 ID 文件</li>
  <li><code class="highlighter-rouge">auto.cnf</code> 配置文件，保存全局系统变量。</li>
</ul>

<h2 id="mysql-系统数据库">mysql 系统数据库</h2>

<p><code class="highlighter-rouge">mysql</code> 数据库是系统数据库，其中的表保存了服务端运行所需的信息。所有的表按功能大致分成以下几类：</p>

<h3 id="数据词典表">数据词典表</h3>

<p>Data Dictionary Tables</p>

<p>这些表由数据词典组成，其中包含了数据库对象的元数据。</p>

<p class="notice">数据词典是 MySQL 8.0 新出现的。启用数据词典的服务端会带来一些操作上的差异。</p>

<p>数据词典表是不可见的，无法被 <code class="highlighter-rouge">SELECT</code> 读取，用 <code class="highlighter-rouge">SHOW TABLES</code> 也不会出现。但是，<code class="highlighter-rouge">INFORMATION_SCHEMA</code> 数据库提供了一个视角，可以查看数据词典的元数据：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">SCHEMATA</span><span class="err">\</span><span class="k">G</span>
<span class="o">***************************</span> <span class="mi">1</span><span class="p">.</span> <span class="k">row</span> <span class="o">***************************</span>
              <span class="k">CATALOG_NAME</span><span class="p">:</span> <span class="n">def</span>
               <span class="k">SCHEMA_NAME</span><span class="p">:</span> <span class="n">mysql</span>
<span class="n">DEFAULT_CHARACTER_SET_NAME</span><span class="p">:</span> <span class="n">utf8mb4</span>
    <span class="n">DEFAULT_COLLATION_NAME</span><span class="p">:</span> <span class="n">utf8mb4_0900_ai_ci</span>
                  <span class="n">SQL_PATH</span><span class="p">:</span> <span class="k">NULL</span>
<span class="o">***************************</span> <span class="mi">2</span><span class="p">.</span> <span class="k">row</span> <span class="o">***************************</span>
              <span class="k">CATALOG_NAME</span><span class="p">:</span> <span class="n">def</span>
               <span class="k">SCHEMA_NAME</span><span class="p">:</span> <span class="n">information_schema</span>
<span class="n">DEFAULT_CHARACTER_SET_NAME</span><span class="p">:</span> <span class="n">utf8</span>
    <span class="n">DEFAULT_COLLATION_NAME</span><span class="p">:</span> <span class="n">utf8_general_ci</span>
                  <span class="n">SQL_PATH</span><span class="p">:</span> <span class="k">NULL</span>
<span class="p">...</span>
</code></pre></div></div>

<p>MySQL 8.0 以前版本的一些系统表已经被数据词典表代替：</p>

<ul>
  <li>旧版的 <code class="highlighter-rouge">event</code> 表被现在的 <code class="highlighter-rouge">events</code> 数据词典表代替</li>
  <li>旧版的 <code class="highlighter-rouge">proc</code> 表被现在的 <code class="highlighter-rouge">parameters</code> 和 <code class="highlighter-rouge">routines</code> 数据词典表代替</li>
</ul>

<h3 id="授权系统表">授权系统表</h3>

<p>Grant System Tables</p>

<p>这些表中包含了用户账号及其权限等信息。</p>

<p>对于 MySQL 8.0 来说，授权表是 <code class="highlighter-rouge">InnoDB</code> （事务）表，之前的版本则是 <code class="highlighter-rouge">MyISAM</code>（非事务）表。授权表底层存储引擎的改变，直接导致了账户管理语句的改变，如 <code class="highlighter-rouge">CREATE USER</code> 和 <code class="highlighter-rouge">GRANT</code>。以前版本中，账户管理语句中如果指定了多个用户，即使其中的部分用户失败，整个语句依然可以成功执行。但语句现在是事务性的，要么全部用户成功，语句成功执行，只要发生任何错误，整个语句就会回滚。</p>

<h4 id="事务">事务</h4>

<p>事务，Transaction，一般是指要做的或所做的事情。在计算机术语中是指访问并可能更新数据库中各种数据项的一个程序执行单元（unit）。在计算机术语中，事务通常就是指数据库事务。</p>

<p>一个数据库事务通常包含对数据库进行读或写的一个 <strong>操作序列</strong>。它的存在包含有以下两个目的：</p>

<ul>
  <li>为数据库操作提供了一个从失败中恢复到正常状态的方法，同时提供了数据库即使在异常状态下仍能保持 <strong>一致性</strong> 的方法。</li>
  <li>当多个应用程序在 <strong>并发访问</strong> 数据库时，可以在这些应用程序之间提供一个 <strong>隔离</strong> 方法，以防止彼此的操作互相干扰。</li>
</ul>

<p>当一个事务被提交给了 DBMS（数据库管理系统）时，DBMS 需要确保该事务中的 <strong>所有操作都成功完成</strong>，且其结果被 <strong>永久保存</strong> 在数据库中，如果事务中有的操作没有成功完成，则事务中的所有操作都需要被 <strong>回滚</strong>，回到事务执行前的状态（要么全执行，要么全都不执行）；同时，该事务对数据库或者其他事务的执行无影响，所有的事务都好像在独立的运行。</p>

<p>但在现实情况下，失败的风险很高。在一个数据库事务的执行过程中，有可能会遇上事务操作失败、数据库系统/操作系统失败，甚至是存储介质失败等情况。这便需要 DBMS 对一个执行失败的事务执行恢复操作，将其数据库状态恢复到一致状态（数据的一致性得到保证的状态）。为了实现将数据库状态恢复到一致状态的功能，DBMS 通常需要维护 <strong>事务日志</strong> 以追踪事务中所有影响数据库数据的操作。</p>

<h3 id="对象信息系统表">对象信息系统表</h3>

<p>Object Information System Tables</p>

<p>这些表所保存的信息是关于存储的程序、组件、用户定义的函数及服务端插件的。</p>

<h3 id="日志系统表">日志系统表</h3>

<p>Log System Tables</p>

<p>服务端用这些表来保存日志。</p>

<ul>
  <li><code class="highlighter-rouge">general_log</code> 普通的查询日志</li>
  <li><code class="highlighter-rouge">slow_log</code> 慢速查询日志</li>
</ul>

<p>日志表使用 CSV 存储引擎。</p>

<h3 id="帮助系统表">帮助系统表</h3>

<p>Server-Side Help System Tables</p>

<p>这些表包含服务端帮助信息。</p>

<h3 id="时区系统表">时区系统表</h3>

<p>Time Zone System Tables</p>

<p>这些表包含时区信息。</p>

<h3 id="复制系统表">复制系统表</h3>

<p>Replication System Tables</p>

<p>服务端使用这些表来支持复制。</p>

<h3 id="优化器系统表">优化器系统表</h3>

<p>这些表用于优化器。</p>

<h3 id="其它系统表">其它系统表</h3>

<p>无法归纳到以上类别的其它表。</p>

<h2 id="mysql-server-日志">MySQL Server 日志</h2>

<p>MySQL Server 有多个日志来帮助用户查明当下发生的事件。</p>

<table>
  <thead>
    <tr>
      <th>日志类型</th>
      <th>写到日志中的信息</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>错误日志</td>
      <td>在 mysqld 启动、运行、暂停期间遇到的问题</td>
    </tr>
    <tr>
      <td>一般查询日志</td>
      <td>已建立的客户端连接和客户端接收的语句</td>
    </tr>
    <tr>
      <td>二进制日志</td>
      <td>改变数据的语句（也用于复制）</td>
    </tr>
    <tr>
      <td>中继日志</td>
      <td>从复制主服务器接收的数据更改</td>
    </tr>
    <tr>
      <td>慢查询的日志</td>
      <td>超过 <code class="highlighter-rouge">long_query_time</code> 秒执行的查询</td>
    </tr>
    <tr>
      <td>DDL 元数据日志</td>
      <td>DDL 语句执行的元数据操作</td>
    </tr>
  </tbody>
</table>

<p>系统默认不会启用任何日志。对于已启用的日志，服务端会把日志文件写入数据目录中。通过对日志的 <strong>冲洗</strong>，用户可以强制服务端关闭并重新打开日志文件，或在某些情况下切换到一个新的日志文件。</p>

<p>冲洗日志的方法：</p>

<ul>
  <li>使用 <code class="highlighter-rouge">FLUSH LOGS</code> 语句</li>
  <li>执行 <code class="highlighter-rouge">mysqladmin flush-logs</code> 或 <code class="highlighter-rouge">mysqladmin refresh</code> 语句</li>
  <li>执行 <code class="highlighter-rouge">mysqldump --flush-logs</code> 或 <code class="highlighter-rouge">mysqldump --master-data</code></li>
  <li>二进制日志在大小超过 <code class="highlighter-rouge">max_binlog_size</code> 系统变量时会自动冲洗</li>
</ul>

<h3 id="自定义查询日志的保存位置">自定义查询日志的保存位置</h3>

<p class="notice">这一块内容，在 <a href="https://dev.mysql.com/doc/refman/8.0/en/log-destinations.html">MySQL 8.0 参考手册原文</a>中写的尤其的混乱，本人尝试按自己的理解整理如下，如有异议，欢迎讨论。</p>

<p>本节内容仅限于 <strong>一般查询日志</strong> 和 <strong>慢查询日志</strong>。</p>

<p>如果要启用一般查询日志和慢查询日志，既可以把日志保存为 <strong>日志文件</strong>，也可以保存到 <strong>数据库</strong> 中，也可以同时保存到文件和数据库中。如果保存到数据库，通常会保存到 <code class="highlighter-rouge">mysql</code> 数据库中的 <code class="highlighter-rouge">general_log</code> 和 <code class="highlighter-rouge">slow_log</code> <strong>表</strong> 中。</p>

<h4 id="把日志保存到数据库">把日志保存到数据库</h4>

<h5 id="把日志保存到数据库的好处">把日志保存到数据库的好处</h5>

<ul>
  <li>日志条目有标准的格式</li>
  <li>可以用 SQL 语句访问日志内容</li>
  <li>可以通过任何客户端远程查询日志</li>
</ul>

<h5 id="查看数据库中的日志">查看数据库中的日志</h5>

<p>要想查看 <strong>日志表的结构</strong>，可以用 <code class="highlighter-rouge">SHOW CREATE TABLE</code> 语句：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SHOW</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">mysql</span><span class="p">.</span><span class="n">general_log</span><span class="p">;</span>
<span class="k">SHOW</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">mysql</span><span class="p">.</span><span class="n">slow_log</span><span class="p">;</span>
</code></pre></div></div>

<p>可以用特定条件来查询日志。如可以查询与某个客户端相关的日志内容，以便查找该客户端发生的查询问题。</p>

<h5 id="使用数据库保存日志的特点">使用数据库保存日志的特点</h5>

<ul>
  <li>总的说来，使用日志表的目的是为用户提供一个接口，便于观察服务在运行时的执行，而不去干扰运行时的执行。</li>
  <li>对一个日志表可以进行 <code class="highlighter-rouge">CREATE TABLE</code>、<code class="highlighter-rouge">ALTER TABLE</code>、<code class="highlighter-rouge">DROP TABLE</code> 操作，其中 <code class="highlighter-rouge">ALTER TABLE</code>、<code class="highlighter-rouge">DROP TABLE</code> 操作需要在日志表未被使用时，且要被禁用，才能进行。</li>
  <li>日志表默认使用 CSV 存储引擎，写入的数据需用逗号分隔。如果用户有权限访问该 <code class="highlighter-rouge">.csv</code> 文件，就可以很方便地将其导入其它电子表格程序中。</li>
  <li>要想禁用日志以便修改或删除日志表，可以用以下方法：
    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">SET</span> <span class="o">@</span><span class="n">old_log_state</span> <span class="o">=</span> <span class="o">@@</span><span class="k">global</span><span class="p">.</span><span class="n">general_log</span><span class="p">;</span>
  <span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">general_log</span> <span class="o">=</span> <span class="s1">'OFF'</span><span class="p">;</span>
  <span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">mysql</span><span class="p">.</span><span class="n">general_log</span> <span class="n">ENGINE</span> <span class="o">=</span> <span class="n">MyISAM</span><span class="p">;</span>
  <span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">general_log</span> <span class="o">=</span> <span class="o">@</span><span class="n">old_log_state</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li><code class="highlighter-rouge">TRUNCATE TABLE</code> 用于清空数据表，可用在那些过期的日志条目上</li>
  <li><code class="highlighter-rouge">RENAME TABLE</code> 可以原子地重命名日志表，可用于日志的滚动
    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">USE</span> <span class="n">mysql</span><span class="p">;</span>
  <span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">general_log2</span><span class="p">;</span>
  <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">general_log2</span> <span class="k">LIKE</span> <span class="n">general_log</span><span class="p">;</span>
  <span class="k">RENAME</span> <span class="k">TABLE</span> <span class="n">general_log</span> <span class="k">TO</span> <span class="n">general_log_backup</span><span class="p">,</span> <span class="n">general_log2</span> <span class="k">TO</span> <span class="n">general_log</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li>可用 <code class="highlighter-rouge">CHECK TABLE</code> 检查日志表的错误。</li>
  <li>对日志表不能使用 <code class="highlighter-rouge">LOCK TABLES</code></li>
  <li>对日志表不能使用 <code class="highlighter-rouge">INSERT</code>、<code class="highlighter-rouge">DELETE</code>、<code class="highlighter-rouge">UPDATE</code>，这些操作只能由服务端内部进行。</li>
  <li><code class="highlighter-rouge">FLUSH TABLES WITH READ LOCK</code> 及 <code class="highlighter-rouge">read_only</code> 系统变量的状态对日志表没有影响，服务端总是可以写入日志表。</li>
  <li>写入日志表中的条目不会被写入二进制日志，因此不会复制到从服务端。</li>
  <li>用 <code class="highlighter-rouge">FLUSH TABLES</code> 冲洗日志表，用 <code class="highlighter-rouge">FLUSH LOGS</code> 冲洗日志文件。</li>
  <li>日志表是无法分区的</li>
  <li>日志表无法用 <code class="highlighter-rouge">mysqldump</code> 来备份</li>
</ul>

<h4 id="控制查询日志的主要变量">控制查询日志的主要变量</h4>

<p>这两种查询日志主要由以下几个变量来控制：</p>

<h5 id="general_log"><code class="highlighter-rouge">general_log</code></h5>

<p>全局变量，<strong>一般查询日志的开关</strong>。变量值为布尔值，为 1 则启用日志，为 0 则禁用日志。</p>

<p>该变量的默认值取决于是否使用了 <code class="highlighter-rouge">--general_log</code> 选项。</p>

<h5 id="general_log_file"><code class="highlighter-rouge">general_log_file</code></h5>

<p>全局变量，一般查询日志文件的文件名，默认值为 <code class="highlighter-rouge">host_name.log</code>，可通过 <code class="highlighter-rouge">--general_log_file</code> 选项来修改其默认值。</p>

<h5 id="slow_query_log"><code class="highlighter-rouge">slow_query_log</code></h5>

<p>全局变量，<strong>慢查询日志的开关</strong>。变量值为布尔值，为 1 则启用日志，为 0 则禁用日志。</p>

<p>该变量的默认值取决于是否使用了 <code class="highlighter-rouge">--slow_query_log</code> 选项。</p>

<h5 id="slow_query_log_file"><code class="highlighter-rouge">slow_query_log_file</code></h5>

<p>全局变量，慢查询日志文件的文件名，默认值为 <code class="highlighter-rouge">host_name-slow.log</code>，可通过 <code class="highlighter-rouge">--slow_query_log_file</code> 选项来修改其默认值。</p>

<h5 id="log_output"><code class="highlighter-rouge">log_output</code></h5>

<p>全局变量。</p>

<p>官方对该变量的解释是：系统变量 <code class="highlighter-rouge">log_output</code> 用于控制一般查询日志和慢查询日志所输出的目标。即把它们保存到哪儿。</p>

<p><strong>有效变量值</strong> ： 如果日志保存为文件，变量值为 <code class="highlighter-rouge">FILE</code>；如果日志保存到数据库中，变量值为 <code class="highlighter-rouge">TABLE</code>；如果不保存日志，变量值为 <code class="highlighter-rouge">NONE</code>。</p>

<p>由此我们看到，该变量实际上同时起到了两个作用：</p>

<ul>
  <li><strong>总开关</strong>：变量值为 <code class="highlighter-rouge">NONE</code> 时，系统绝对不会保存一般查询日志和慢查询日志，即使 <code class="highlighter-rouge">general_log</code> 或 <code class="highlighter-rouge">slow_guery_log</code> 为 1 也没用。</li>
  <li><strong>日志输出形式</strong>：如果变量值不为 <code class="highlighter-rouge">NONE</code>，说明总开关打开，启用这两个查询日志。
    <ul>
      <li><code class="highlighter-rouge">FILE</code> ： 日志保存为文件</li>
      <li><code class="highlighter-rouge">TABLE</code> ： 日志保存到数据库中的表</li>
    </ul>
  </li>
</ul>

<p>无论从逻辑上还是从操作上看，把日志保存到文件和保存到数据库是不相冲突的，因此应该允许同时把日志保存到文件和数据库中。</p>

<p>可通过 <code class="highlighter-rouge">--log-output[=value,...]</code> 选项来为变量 <code class="highlighter-rouge">log_output</code> 赋值：</p>

<ul>
  <li>赋值时允许使用 <code class="highlighter-rouge">TABLE, FILE</code> 这样的列表，用逗号分隔</li>
  <li><code class="highlighter-rouge">log_output</code> 默认值为 <code class="highlighter-rouge">FILE</code>。因此，如果没有使用 <code class="highlighter-rouge">--log-output</code> 选项，则会默认把日志保存为文件。</li>
  <li>虽然有点儿傻，但如果赋值时列表中含有 <code class="highlighter-rouge">NONE</code>，则列表中其他值无效，总开关关闭，禁用日志。</li>
</ul>

<h6 id="变量的配合使用">变量的配合使用</h6>

<p><code class="highlighter-rouge">log_output</code> 做为查询日志的总开关，控制是否启用，及输出的形式。</p>

<p><code class="highlighter-rouge">general_log</code> 和 <code class="highlighter-rouge">slow_query_log</code> 做为二级开关需要与总开关配合使用。要想开启某个查询日志，<strong>两层</strong> 开关必须 <strong>同时打开</strong>。</p>

<p>以下范例使用命令行选项为变量赋值：</p>

<ul>
  <li>两种查询日志均开启，把日志同时保存到文件及数据库：<code class="highlighter-rouge">--log-output=FILE,TABLE --general_log=1 --slow_query_log=1</code></li>
  <li>两种查询日志均开启，把日志仅保存到数据库： <code class="highlighter-rouge">--log-output=TABLE --general_log --slow_query_log</code></li>
  <li>仅开启慢查询日志，仅保存为文件： <code class="highlighter-rouge">--log-output=FILE --slow_query_log</code>，或简写为 <code class="highlighter-rouge">--slow_query_log</code>，因为 <code class="highlighter-rouge">FILE</code> 是默认值</li>
</ul>

<blockquote>
  <p>选项简写说明：<code class="highlighter-rouge">--general_log=1</code> 可以简写为 <code class="highlighter-rouge">--general_log</code>，<code class="highlighter-rouge">--slow_query_log=1</code> 可简写为 <code class="highlighter-rouge">--slow_query_log</code></p>
</blockquote>

<h5 id="sql_log_off"><code class="highlighter-rouge">sql_log_off</code></h5>

<p><code class="highlighter-rouge">sql_log_off</code> 为会话变量，布尔值。</p>

<p>该变量仅用于控制：对于 <strong>当前连接</strong>，是否启用日志。</p>

<h4 id="在启动服务时指定日志形式">在启动服务时指定日志形式</h4>

<p><code class="highlighter-rouge">general_log</code> 和 <code class="highlighter-rouge">slow_query_log</code> 的布尔值即可以用 1/0 表示，也可以用 ON/OFF 表示。</p>

<p>在启动服务时通过选项以 <code class="highlighter-rouge">--log-output=FILE</code>，<code class="highlighter-rouge">--general_log=1</code>，<code class="highlighter-rouge">--slow_query_log=1</code> 的形式来控制日志的开启。具体使用方法已在上文范例中演示。</p>

<p>当然还可以直接修改配置文件：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">general_log</span><span class="o">=</span>1
<span class="nv">general_log_file</span><span class="o">=</span>my_logs.txt
</code></pre></div></div>

<h4 id="在运行时设定日志形式">在运行时设定日志形式</h4>

<p>这些变量均可以在运行时设定：</p>

<p><code class="highlighter-rouge">log_output</code>、<code class="highlighter-rouge">general_log</code>、<code class="highlighter-rouge">general_log_file</code>、<code class="highlighter-rouge">slow_query_log</code>、<code class="highlighter-rouge">slow_query_log_file</code>、<code class="highlighter-rouge">sql_log_off</code>。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">log_output</span> <span class="o">=</span> <span class="s1">'TABLE'</span><span class="p">;</span>
<span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">general_log</span> <span class="o">=</span> <span class="s1">'ON'</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="错误日志">错误日志</h3>

<p>错误日志中包含 mysqld 启动和关闭期间诸如错误、警告、通知这类诊断消息。</p>

<h4 id="错误日志系统变量">错误日志系统变量</h4>

<h5 id="log_error-系统变量"><code class="highlighter-rouge">log_error</code> 系统变量</h5>

<p>默认的错误日志输出目标。因此 <strong>错误日志保存到哪里</strong> 是由这个变量决定的。</p>

<ul>
  <li>如果 <code class="highlighter-rouge">log_error</code> 变量值为 <strong>文件名</strong>，则日志文件保存为数据目录中的 <code class="highlighter-rouge">文件名.NN.json</code>，NN 从 00 开始计数。如 <code class="highlighter-rouge">filename.00.json</code>、<code class="highlighter-rouge">filename.01.json</code> 等。</li>
  <li>如果变量值为 <code class="highlighter-rouge">stderr</code>，则日志输出到终端。</li>
</ul>

<p>该变量可以通过 <code class="highlighter-rouge">--log-error[=file_name]</code> 来赋值。如果使用选项时未指定文件名，则默认文件名为数据目录中的 <code class="highlighter-rouge">host_name.err</code>。</p>

<h5 id="log_error_services-系统变量"><code class="highlighter-rouge">log_error_services</code> 系统变量</h5>

<p>该变量用于控制在错误日志中 <strong>启用哪些组件</strong>，以及以什么 <strong>顺序</strong> 使用这些组件。</p>

<p>变量值为日志组件列表，用分号分隔。列表中的组件是按服务端执行它们的 <strong>顺序</strong> 排列的。这些组件要么是内建组件，要么必须提前用 <code class="highlighter-rouge">INSTALL COMPONENT</code> 安装到系统中。</p>

<p>服务端会按照 <code class="highlighter-rouge">log_error_services</code> 变量值中，各组件排列顺序来执行 filter 和 sink 的。</p>

<p>该变量的默认值为 <code class="highlighter-rouge">log_filter_internal; log_sink_internal</code>。表示日志事件首先通过内建组件 <code class="highlighter-rouge">log_filter_internal</code>，筛选出来的日志交给内建组件 <code class="highlighter-rouge">log_sink_internal</code>，把日志事件转换成日志消息格式，再输出到特定位置，如文件或系统日志。</p>

<p>如果 <code class="highlighter-rouge">log_error_services</code> 的变量值中没有 sink 组件，则不会有日志输出。</p>

<h5 id="log_error_verbosity-系统变量"><code class="highlighter-rouge">log_error_verbosity</code> 系统变量</h5>

<p>该变量决定着 <code class="highlighter-rouge">log_filter_internal</code> 组件应该筛选哪些日志事件。</p>

<ul>
  <li>变量值为 1 时，筛选错误消息</li>
  <li>变量值为 2 时，筛选错误和警告消息</li>
  <li>变量值为 3 时，筛选错误、警告、通知消息</li>
</ul>

<h5 id="dragnetlog_error_filter_rules-系统变量"><code class="highlighter-rouge">dragnet.log_error_filter_rules</code> 系统变量</h5>

<h4 id="错误日志组件">错误日志组件</h4>

<p>日志的组件分两类：filter 和 sink</p>

<ul>
  <li>filter ： 用于 <strong>处理</strong> 日志事件。如添加、删除、修改事件字段，或删除整条事件。把最后得到的事件 <strong>传递</strong> 给 <code class="highlighter-rouge">log_error_services</code> 变量中的下一个组件。</li>
  <li>sink ： sink 把日志事件 <strong>格式化</strong> 成日志消息，并将其 <strong>写入</strong> 相关输出，如日志文件或系统日志。</li>
</ul>

<h5 id="filter-组件">Filter 组件</h5>

<p>filter 组件完成针对错误日志事件的 <strong>筛选</strong>，可以理解为日志的 <strong>过滤器</strong>。</p>

<ul>
  <li>要是没有启用 filter 组件，就不会进行筛选。</li>
  <li><code class="highlighter-rouge">log_error_services</code> 变量中启用的 filter 组件仅对其 <strong>后面的</strong> sink 组件 <strong>有作用</strong></li>
</ul>

<h6 id="log_filter_internal-组件"><code class="highlighter-rouge">log_filter_internal</code> 组件</h6>

<ul>
  <li>任务 ：基于 <code class="highlighter-rouge">log_error_verbosity</code> 系统变量进行日志的筛选。</li>
  <li>URN ：该组件为内建组件，使用前无需专门加载</li>
  <li>允许多用途使用 ：是</li>
</ul>

<p>如果未启用 <code class="highlighter-rouge">log_filter_internal</code> 组件，<code class="highlighter-rouge">log_error_verbosity</code> 变量就不会生效。</p>

<h6 id="log_filter_dragnet-组件"><code class="highlighter-rouge">log_filter_dragnet</code> 组件</h6>

<ul>
  <li>任务 ：基于 <code class="highlighter-rouge">dragnet.log_error_filter_rules</code> 系统变量设定的规则进行日志的筛选。</li>
  <li>URN ：<code class="highlighter-rouge">file://component_log_filter_dragnet</code></li>
  <li>允许多用途使用 ：否</li>
</ul>

<h5 id="sink-组件">Sink 组件</h5>

<p>sink 组件负责日志的 <strong>写入</strong>，可以理解为日志的 <strong>书写器</strong>。如果未启用任何 sink 组件，则不会有任何日志输出。</p>

<h6 id="log_sink_internal-组件"><code class="highlighter-rouge">log_sink_internal</code> 组件</h6>

<ul>
  <li>任务 ：使用传统的错误日志消息的输出格式</li>
  <li>URN ：该组件为内建组件，使用前无需专门加载</li>
  <li>允许多用途使用 ：否</li>
  <li>输出 ：写入默认的错误日志输出</li>
</ul>

<h6 id="log_sink_json-组件"><code class="highlighter-rouge">log_sink_json</code> 组件</h6>

<ul>
  <li>任务 ：使用 JSON 格式的错误日志</li>
  <li>URN ：<code class="highlighter-rouge">file://component_log_sink_json</code></li>
  <li>允许多用途使用 ：是</li>
  <li>输出 ：基于 <code class="highlighter-rouge">log_error</code> 系统变量的设定</li>
</ul>

<h6 id="log_sink_syseventlog-组件"><code class="highlighter-rouge">log_sink_syseventlog</code> 组件</h6>

<ul>
  <li>任务 ：把错误日志写入系统日志 <code class="highlighter-rouge">syslog</code>。</li>
  <li>URN ：<code class="highlighter-rouge">file://component_log_sink_syseventlog</code></li>
  <li>允许多用途使用 ：是</li>
  <li>输出 ：写入系统日志</li>
</ul>

<h6 id="log_sink_test-组件"><code class="highlighter-rouge">log_sink_test</code> 组件</h6>

<ul>
  <li>任务 ：主要用于内部测试，不用于生产</li>
  <li>URN ：<code class="highlighter-rouge">file://component_log_sink_test</code></li>
  <li>允许多用途使用 ：是</li>
  <li>输出 ：写入默认的错误日志输出</li>
</ul>

<h4 id="错误日志组件配置">错误日志组件配置</h4>

<p>在 MySQL 8.0 中，错误日志使用 MySQL 组件架构。错误日志子系统由组件和系统变量组成。其中，组件负责日志事件的 <strong>过滤</strong> 和 <strong>写入</strong>，系统变量用于配置特定组件，以实现所需的日志结果。</p>

<h5 id="错误日志的特点">错误日志的特点</h5>

<ul>
  <li>filter 组件对日志事件进行筛选，影响获取到的信息</li>
  <li>sink 组件负责日志事件的输出。可以启用多个 sink 组件，以实现向多目标输出日志</li>
  <li>内建的 filter 和 sink 组件组合在一起形成默认的日志格式</li>
  <li>通过可加载的 sink 组件，可以实现把错误日志写入系统日志</li>
  <li>通过可加载的 sink 组件，可以实现 JSON 格式的错误日志</li>
  <li>由系统变量控制启用哪个组件，及使用哪些规则来筛选日志</li>
</ul>

<h5 id="修改日志组件">修改日志组件</h5>

<p>要想修改错误日志使用的组件，如果不是内建组件，需要先将其加载，然后修改 <code class="highlighter-rouge">log_error_services</code> 变量的值。</p>

<p>要想启用某个非内建的日志组件，先用 <code class="highlighter-rouge">INSTALL COMPONENT</code> 加载它，然后把它加入 <code class="highlighter-rouge">log_error_services</code> 变量。</p>

<p>要想禁用某个日志组件，先从 <code class="highlighter-rouge">log_error_services</code> 变量中将其移除，再用 <code class="highlighter-rouge">UNINSTALL COMPONET</code> 将其卸载。</p>

<p>如，想用 <code class="highlighter-rouge">log_sink_syseventlog</code> 组件来代替默认的 <code class="highlighter-rouge">log_sink_internal</code>，先要加载它，再修改 <code class="highlighter-rouge">log_error_services</code> 变量的值：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">INSTALL</span> <span class="n">COMPONENT</span> <span class="s1">'file://component_log_sink_syseventlog'</span><span class="p">;</span>
<span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">log_error_services</span> <span class="o">=</span> <span class="s1">'log_filter_internal; log_sink_syseventlog'</span><span class="p">;</span>
</code></pre></div></div>

<p>加载日志组件时所使用的 URN 是复合文件名，前缀为 <code class="highlighter-rouge">file://component_</code>。</p>

<h6 id="使用多个-sink-组件">使用多个 sink 组件</h6>

<p>可以设置多个 sink 组件，把日志输出到多个目标。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">log_error_services</span> <span class="o">=</span> <span class="s1">'log_filter_internal; log_sink_internal; log_sink_syseventlog'</span><span class="p">;</span>
</code></pre></div></div>

<p>恢复默认：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">log_error_services</span> <span class="o">=</span> <span class="s1">'log_filter_internal; log_sink_internal;'</span>
<span class="n">UNINSTALL</span> <span class="n">COMPONENT</span> <span class="s1">'file://component_log_sink_syseventlog'</span><span class="p">;</span>
</code></pre></div></div>

<h6 id="保存对组件的修改">保存对组件的修改</h6>

<p>要想对组件的修改在服务启动时就自动生效：</p>

<ul>
  <li>如果组件可加载，则使用 <code class="highlighter-rouge">INSTALL COMPONENT</code> ，这会将该组件在系统表 <code class="highlighter-rouge">mysql.component</code> 中将其注册，以后服务端启动时就会自动加载了。</li>
  <li>在配置文件 <code class="highlighter-rouge">my.cnf</code> 中设定 <code class="highlighter-rouge">log_error_services</code> 变量</li>
  <li>在运行时使用 <code class="highlighter-rouge">SET PERSIST</code> 将立即生效，而且会保存，重启仍然有效</li>
</ul>

<h6 id="范例">范例</h6>

<p>希望每次服务启动时，在默认配置基础上，额外再使用 <code class="highlighter-rouge">log_sink_json</code> 组件来保存日志。</p>

<p>如果没有加载，则先加载 JSON 组件：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">INSTALL</span> <span class="n">COMPONENT</span> <span class="s1">'file://component_log_sink_json'</span><span class="p">;</span>
</code></pre></div></div>

<p>然后，在配置文件 <code class="highlighter-rouge">my.cnf</code> 中修改 <code class="highlighter-rouge">log_error_services</code> 变量：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>mysqld]
<span class="nv">log_error_services</span><span class="o">=</span><span class="s1">'log_filter_internal; log_sink_internal; log_sink_json'</span>
</code></pre></div></div>

<p>或者，也可以在运行时用 <code class="highlighter-rouge">SET PERSIST</code> 来修改变量：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SET</span> <span class="n">PERSIST</span> <span class="n">log_error_services</span> <span class="o">=</span> <span class="s1">'log_filter_internal; log_sink_internal; log_sink_json'</span><span class="p">;</span>
</code></pre></div></div>

<p>一定要保证变量中各组件的顺序，如：</p>

<p><code class="highlighter-rouge">log_filter_internal; log_sink_1; log_sink_2</code></p>

<p>日志事件先由内建的 filter 筛选，然后交给第一个书写器，再交给第二个书写器。两个书写器都会收到筛选出来的日志事件。</p>

<p>再如：</p>

<p><code class="highlighter-rouge">log_sink_1; log_filter_internal; log_sink_2</code></p>

<p>日志事件先是传给第一个书写器，然后再由内建过滤器筛选，筛选后交给第二个书写器。</p>

<p>第一个书写器收到的是未经筛选的事件，第二个书写器收到的是经过筛选的事件。这样就可以得到一个完整的不分类的日志，和一个错误日志。</p>

<h2 id="mysql-server-组件">MySQL Server 组件</h2>

<p>MySQL Server 包含一个基于组件的架构，用来扩展其服务端功能。</p>

<ul>
  <li>组件可以为服务端和其它组件提供服务，组件之间仅通过它们提供的服务来交互</li>
  <li>使用 <code class="highlighter-rouge">INSTALL COMPONENT</code> 和 <code class="highlighter-rouge">UNINSTALL COMPONENT</code> 语句来加载和卸载组件</li>
  <li>加载服务用来处理组件的加载和卸载，并把已加载的组件放入 <code class="highlighter-rouge">mysql.component</code> 系统表中，作为注册表</li>
</ul>

<p>用于控制组件的 SQL 语句对于服务端的运行以及 <code class="highlighter-rouge">mysql.component</code> 系统表有如下影响：</p>

<ul>
  <li><code class="highlighter-rouge">INSTALL COMPONENT</code> 把组件加载到服务端。组件会立即激活，加载服务还会把加载的组件注册到 <code class="highlighter-rouge">mysql.component</code> 系统表中。之后服务端重启时，<code class="highlighter-rouge">mysql.component</code> 中的所有组件都会被加载。</li>
  <li><code class="highlighter-rouge">UNINSTALL COMPONENT</code> 会停用组件，并从服务端卸载。加载服务将其从 <code class="highlighter-rouge">mysql.component</code> 移除，下次重启不会加载。</li>
</ul>

<p>查看系统当前已安装的组件：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">mysql</span><span class="p">.</span><span class="n">component</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="一台主机运行多个-mysql-实例">一台主机运行多个 MySQL 实例</h2>

<p>有时需要在一台主机上同时运行多个 MySQL 的实例，如为了测试一个新版的 MySQL，同时不影响现有的版本，或者需要让不同的用户访问不同的 mysqld 服务端。</p>

<p>我们可以做到每个实例使用不同的 MySQL Server 二进制文件，或多个实例使用同一个二进制文件，或二者的任意组合。如，可以同时运行两个版本的 MySQL，以观察它们对待同一个工作流有什么区别。或者运行同一个版本的多个实例，每个实例管理不同的数据库。</p>

<p>不管是否使用不同的服务端二进制文件，每个运行的实例都必须给某些运行参数赋予唯一的值，以避免不同实例间的冲突。参数可以在命令行、配置文件设置，也可以通过设置环境变量实现。</p>

<p>要想查看某个实例使用的变量及值，可用 <code class="highlighter-rouge">SHOW VARIABLES</code> 语句。</p>

<p>MySQL 实例管理的主要资源是数据目录，每个实例应该使用不同的数据目录，用 <code class="highlighter-rouge">--datadir=</code> 选项指定。</p>

<p>除了使用不同的数据目录，每个服务端实例对于以下选项也要有不同的值：</p>

<p><code class="highlighter-rouge">--port=port_num</code> ： 用于控制 TCP/IP 连接的端口号。或者，如果主机有不同的网址，也可以使用 <code class="highlighter-rouge">--bind-address</code> 让每个服务端侦听不同的地址。</p>

<p><code class="highlighter-rouge">--socket={file_name|pipe_name}</code> ： 用于控制套接字文件路径。</p>

<p><code class="highlighter-rouge">--pid-file=file_name</code> ： 服务端把其进程 ID 写到哪个文件中</p>

<p><code class="highlighter-rouge">--general_log_file=file_name</code></p>

<p><code class="highlighter-rouge">--log-bin[=file_name]</code></p>

<p><code class="highlighter-rouge">--slow_query_log_file=file_name</code></p>

<p><code class="highlighter-rouge">--log-error[=file_name]</code></p>

<p><code class="highlighter-rouge">--tmpdir=dir_name</code> ： 为每个实例分配不同的物理磁盘，以分摊负载。</p>

<p>如果在不同位置有多个 MySQL 的安装文件，可以用 <code class="highlighter-rouge">--basedir=dir_name</code> 选项为每个安装文件设置各自的基准目录，这会促使每个安装文件都自动使用不同的数据目录、日志文件和 PID 文件，因为这些参数的默认值都与基准目录有关。于是，剩下需要指定的只有 <code class="highlighter-rouge">--socket</code> 和 <code class="highlighter-rouge">--port</code> 两个选项了。</p>

        
      </section>




      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
	<hr />
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> 标签: </strong>
    <span itemprop="keywords">
    
		
      <a href="/tag/mysql" class="page__taxonomy-item" rel="tag">mysql</a><span class="sep">  </span>
    
		
      <a href="/tag/server" class="page__taxonomy-item" rel="tag">server</a>
    
    </span>
  </p>













  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> 分类: </strong>
	<!--  <hr />    -->
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/categories/#database" class="page__taxonomy-item" rel="tag">database</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 更新时间:</strong> <time datetime="2016-03-01T00:00:00+08:00">March 01, 2016</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">分享</h4>
  

  <a href="https://twitter.com/intent/tweet?via=liloli&text=MySQL+%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%9A%84%E7%AE%A1%E7%90%86%20http%3A%2F%2Flocalhost%3A4000%2Fdatabase%2Fmysql_server_managemt%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="分享 Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fdatabase%2Fmysql_server_managemt%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="分享 Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http%3A%2F%2Flocalhost%3A4000%2Fdatabase%2Fmysql_server_managemt%2F" class="btn btn--google-plus" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="分享 Google Plus"><i class="fab fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fdatabase%2Fmysql_server_managemt%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="分享 LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="http://localhost:4000/database/mysql_security/" class="pagination--pager" title="MySQL 的安全
">向前</a>
    
    
      <a href="http://localhost:4000/app/rsync/" class="pagination--pager" title="rsync 的用法
">向后</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">猜您还喜欢</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/bash/time/" rel="permalink">Bash 脚本 - 时间
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/bash/storage/" rel="permalink">Bash 脚本 - 存储空间
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/bash/numbers/" rel="permalink">Bash 脚本 - 数字
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/bash/input/" rel="permalink">Bash 脚本 - 输入
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>
        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
  <input type="text" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  <div id="results" class="results"></div>
</div>
      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->


<!-- end custom footer snippets -->

        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>关注:</strong></li>
    
    
      <li><a href="https://twitter.com/liloli"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
      <li><a href="https://www.facebook.com/lilolibj"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
    
    
      <li><a href="https://github.com/liloli"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 Hawk Zhang. 技术来自于 <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="http://localhost:4000/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>



  
  
  <script src="http://localhost:4000/assets/js/lunr/lunr.min.js"></script>
  <script src="http://localhost:4000/assets/js/lunr/lunr-store.js"></script>
  <script src="http://localhost:4000/assets/js/lunr/lunr-en.js"></script>





    
  <script>
    var disqus_config = function () {
      this.page.url = "http://localhost:4000/database/mysql_server_managemt/";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/database/mysql_server_managemt"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://liloli.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  



  </body>
</html>
